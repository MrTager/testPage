<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>打开小程序</title>
    <!-- weui 样式 -->
    <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/2.4.1/weui.min.css">
    <style>
      body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background-color: #f5f5f5;
      }
      .container {
        text-align: center;
        padding: 20px;
      }
      .open-btn {
        width: 200px;
        height: 45px;
        text-align: center;
        font-size: 17px;
        display: inline-block;
        margin: 20px 0;
        padding: 8px 24px;
        border: none;
        border-radius: 4px;
        background-color: #07c160;
        color: #fff;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="wechat-container" class="container" style="display: none;">
      <p>点击按钮打开小程序</p>
      <wx-open-launch-weapp 
        id="launch-btn" 
        username="wx51ecbd53c7316338" 
        path="pages/H5HotService/index?url=https%3A%2F%2Fzwfw.gat.nx.gov.cn%2Fnxzq%2Fmobile%2Fga%2Fhome%3Ftoken%3D%7Btoken%7D&permission=L3">
        <template>
          <button class="open-btn">打开小程序</button>
        </template>
      </wx-open-launch-weapp>
    </div>

    <div id="other-container" class="container">
      <p>请在微信中打开此页面</p>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var ua = navigator.userAgent.toLowerCase();
        var isWeixin = ua.indexOf('micromessenger') > -1;

        console.log('是否微信:', isWeixin);

        if (isWeixin) {
          document.getElementById('wechat-container').style.display = 'block';
          document.getElementById('other-container').style.display = 'none';

          // 监听开放标签事件（可选，用于调试）
          var launchBtn = document.getElementById('launch-btn');
          if (launchBtn) {
            launchBtn.addEventListener('ready', function (e) {
              console.log('开放标签 ready');
            });
            launchBtn.addEventListener('launch', function (e) {
              console.log('开放标签 success');
            });
            launchBtn.addEventListener('error', function (e) {
              console.log('开放标签 fail', e.detail);
              alert('打开小程序失败: ' + JSON.stringify(e.detail));
            });
          } else {
            console.error('未找到 launch-btn 元素');
          }
        } else {
          document.getElementById('wechat-container').style.display = 'none';
          document.getElementById('other-container').style.display = 'block';
        }
      });
    </script>
  </body>
</html>